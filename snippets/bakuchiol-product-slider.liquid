{{ 'bakuchiol-product-slider.css' | asset_url | stylesheet_tag }}

<div class="bakuchiol-product-slider__wrapper" id="bakuchiol-product">
  <!-- BIG SLIDER -->
  <div class="swiper bakuchiol-product-slider__big">
    <div class="swiper-wrapper">
      {% assign media_counter = 0 %}
      {% for media in product.media %}
        {% if media.media_type == 'image' %}
          <div class="swiper-slide">
            <div class="bakuchiol-product-slider__image-big js-zoom-container">
              <img
                src="{{ media | image_url: width: 1600 }}"
                srcset="
                  {{ media | image_url: width: 600 }} 600w,
                  {{ media | image_url: width: 900 }} 900w,
                  {{ media | image_url: width: 1200 }} 1200w,
                  {{ media | image_url: width: 1600 }} 1600w,
                  {{ media | image_url: width: 2000 }} 2000w
                "
                sizes="(min-width: 1200px) 550px, 100vw"
                loading="lazy"
                alt="{{ media.alt | escape }}"
                class="bakuchiol-product-slider__img js-zoom-img"
              >
            </div>
          </div>
          {% assign media_counter = media_counter | plus: 1 %}
        {% endif %}
      {% endfor %}
    </div>

    <!-- NAV / BULLETS (sits on top but lets clicks reach image) -->
    <div class="bakuchiol-product-slider-navigation">
      <div class="bakuchiol-product__pagination"></div>

      <div class="bakuchiol-product-slider__btns">
        <button class="bakuchiol-slider__btn prev bakuchiol-product-slider__btn--prev" type="button">
          <svg
            width="30"
            height="30"
            viewBox="-19.04 0 75.804 75.804"
            xmlns="http://www.w3.org/2000/svg"
            fill="#ffffff"
          >
            <g>
              <g transform="translate(-831.568 -384.448)">
                <path d="M833.068,460.252a1.5,1.5,0,0,1-1.061-2.561l33.557-33.56a2.53,2.53,0,0,0,0-3.564l-33.557-33.558a1.5,1.5,0,0,1,2.122-2.121l33.556,33.558a5.53,5.53,0,0,1,0,7.807l-33.557,33.56A1.5,1.5,0,0,1,833.068,460.252Z" />
              </g>
            </g>
          </svg>
        </button>

        <button class="bakuchiol-slider__btn bakuchiol-product-slider__btn--next" type="button">
          <svg
            width="30"
            height="30"
            viewBox="-19.04 0 75.804 75.804"
            xmlns="http://www.w3.org/2000/svg"
            fill="#ffffff"
          >
            <g>
              <g transform="translate(-831.568 -384.448)">
                <path d="M833.068,460.252a1.5,1.5,0,0,1-1.061-2.561l33.557-33.56a2.53,2.53,0,0,0,0-3.564l-33.557-33.558a1.5,1.5,0,0,1,2.122-2.121l33.556,33.558a5.53,5.53,0,0,1,0,7.807l-33.557,33.56A1.5,1.5,0,0,1,833.068,460.252Z" />
              </g>
            </g>
          </svg>
        </button>
      </div>
    </div>
  </div>

  {%- comment -%}
    THUMBS BLOCK (optional). Leave commented out if you donâ€™t want thumbs.
  {%- endcomment -%}
  {%- comment -%}
  <div thumbsSlider class="swiper bakuchiol-product-slider__thumbs">
    <div class="swiper-wrapper">
      {% assign media_counter = 0 %}
      {% for media in product.media %}
        {% if media.media_type == 'image' %}
          <div class="swiper-slide">
            <div class="bakuchiol-product-slider__image-thumbs">
              {{ media | image_url: width: 165 | image_tag: loading: 'lazy', alt: media.alt | escape }}
            </div>
          </div>
          {% assign media_counter = media_counter | plus: 1 %}
        {% endif %}
      {% endfor %}
    </div>
  </div>
  {%- endcomment -%}
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
  /* Swiper */
  var swiper2 = new Swiper('.bakuchiol-product-slider__big', {
    spaceBetween: 5,
    speed: 800,
    pagination: {
      el: '.bakuchiol-product__pagination',
      clickable: true,
      type: 'bullets',
      bulletClass: 'bakuchiol-product-slider-bullets',
      bulletActiveClass: 'bakuchiol-product-slider-bullets-active',
      renderBullet: function (index, className) {
        var number = index + 1;
        return '<span class="' + className + '">' + (number < 10 ? '0' + number : number) + '</span>';
      }
    },
    navigation: {
      nextEl: '.bakuchiol-product-slider__btn--next',
      prevEl: '.bakuchiol-product-slider__btn--prev'
    },
    breakpoints: {
      1023: { spaceBetween: 10 }
    }
  });

  /* CLICK-ONLY ZOOM */
  function initZoomClickOnly() {
    let containers = document.querySelectorAll('.js-zoom-container');

    containers.forEach(container => {
      const img = container.querySelector('.js-zoom-img');
      if (!img) return;

      /* Remove prior listeners by cloning */
      const clone = container.cloneNode(true);
      container.parentNode.replaceChild(clone, container);
      container = clone;

      const image = container.querySelector('.js-zoom-img');

      let zoomed = false;

      container.addEventListener('click', function (e) {
        e.preventDefault();
        e.stopPropagation();

        zoomed = !zoomed;

        if (zoomed) {
          container.classList.add('is-zoomed');
        } else {
          container.classList.remove('is-zoomed');
          image.style.transformOrigin = "center center";
        }
      });

      /* Pan only when zoomed */
      container.addEventListener('mousemove', function (e) {
        if (!zoomed) return;

        const rect = container.getBoundingClientRect();
        const x = ((e.clientX - rect.left) / rect.width) * 100;
        const y = ((e.clientY - rect.top) / rect.height) * 100;

        image.style.transformOrigin = `${x}% ${y}%`;
      });
    });
  }

  initZoomClickOnly();

  /* Re-init on resize */
  window.addEventListener('resize', () => {
    clearTimeout(window.__zoomReset);
    window.__zoomReset = setTimeout(initZoomClickOnly, 200);
  });
});
</script>